{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": ".reflekt/profile/1-0.json",
    "description": "Schema for Reflekt profiles",
    "self": {
        "vendor": "com.reflekt-ci",
        "name": "profile",
        "format": "jsonschema",
        "version": "1-0"
    },
    "type": "object",
    "properties": {
        "collector": {
            "type": "object",
            "properties": {
                "type": {
                    "type": "string",
                    "enum": ["segment", "rudderstack", "snowplow", "amplitude"]
                }
            }
        },
        "registry": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "type": {
                        "type": "string",
                        "enum": ["avo", "segment", "snowplow", "rudderstack", "amplitude"]
                    }
                },
                "allOf": [
                    {
                        "if": {
                            "properties": {"type": {"const": "segment"}},
                            "required": ["type"]
                        },
                        "then": {
                            "properties": {
                                "api_token": {"type": "string"}
                            },
                            "required": ["api_token"]
                        }
                    },
                    {
                        "if": {
                            "properties": {"type": {"const": "snowplow"}},
                            "required": ["type"]
                        },
                        "then": {
                            "properties": {
                                "url": {"type": "string"}
                            },
                            "required": ["url"]
                        }
                    },
                    {
                        "if": {
                            "properties": {"type": {"const": "rudderstack"}},
                            "required": ["type"]
                        },
                        "then": {
                            "properties": {
                                "access_token": {"type": "string"}
                            },
                            "required": ["access_token"]
                        }
                    },
                    {
                        "if": {
                            "properties": {"type": {"const": "amplitude"}},
                            "required": ["type"]
                        },
                        "then": {
                            "properties": {
                                "access_token": {"type": "string"}
                            },
                            "required": ["access_token"]
                        }
                    },
                    {
                        "if": {
                            "properties": {"type": {"const": "avo"}},
                            "required": ["type"]
                        },
                        "then": {
                            "properties": {
                                "service_account_name": {"type": "string"},
                                "service_account_secret": {"type": "string"}
                            },
                            "required": ["service_account_name", "service_account_secret"]
                        }
                    }
                ]
            }
        },
        "target": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "name": {"type": "string"},
                    "type": {
                        "type": "string",
                        "enum": ["snowflake", "redshift", "bigquery"]
                    }
                },
                "allOf": [
                    {
                        "if": {
                            "properties": {"type": {"const": "snowflake"}},
                            "required": ["type"]
                        },
                        "then": {
                            "properties": {
                                "account": {"type": "string"},
                                "database": {"type": "string"},
                                "warehouse": {"type": "string"},
                                "role": {"type": "string"},
                                "user": {"type": "string"},
                                "password": {"type": "string"}
                            },
                            "required": ["account", "database", "warehouse", "role", "user", "password"]
                        }
                    },
                    {
                        "if": {
                            "properties": {"type": {"const": "redshift"}},
                            "required": ["type"]
                        },
                        "then": {
                            "properties": {
                                "host": {"type": "string"},
                                "port": {"type": "integer"},
                                "database": {"type": "string"},
                                "user": {"type": "string"},
                                "password": {"type": "string"}
                            },
                            "required": ["host", "port", "database", "user", "password"]
                        }
                    },
                    {
                        "if": {
                            "properties": {"type": {"const": "bigquery"}},
                            "required": ["type"]
                        },
                        "then": {
                            "properties": {
                                "method": {"type": "string", "enum": ["service-account"]},
                                "project": {"type": "string"},
                                "dataset": {"type": "string"},
                                "keyfile": {"type": "string"}
                            },
                            "required": ["method", "project", "dataset", "keyfile"]
                        }
                    }
                ]
            }
        },
        "do_not_track": {"type": "boolean"}
    },
    "required": ["collector", "registry", "target"]
}
